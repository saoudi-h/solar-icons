import icons from '@solar-icons/core/metadata-descriptions.json' assert { type: 'json' }
import fs from 'node:fs'

const outputDataFilePath = './core/generated/descriptions.ts'

const toPascalCase = (str: string) =>
    str
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('')

type IconData = {
    name: string
    category: string
    categoryTags: string[]
    tags: string[]
}

const generate = (iconsData: IconData[]): string => {
    const iconEntries = Object.values(iconsData)
    const uniqueIcons = Array.from(new Set(iconEntries.map(icon => toPascalCase(icon.name)))).sort()

    let data = `/* Generated by core/scripts/generate-descriptions.ts */

import { ${uniqueIcons.join(', ')} } from '@solar-icons/react'
import type { Icon as IconType } from '@solar-icons/react/lib/types'
import type { Category } from './utils'

export interface IconData {
    name: string
    category: Category
    categoryTags: string[]
    tags: string[]
    Icon: IconType
}

export const icons: IconData[] = [
`
    const res = iconEntries.map((icon) => {
        return `    {
        name: '${icon.name}',
        category: '${icon.category}' as Category,
        categoryTags: ${JSON.stringify(icon.categoryTags)},
        tags: ${JSON.stringify(icon.tags)},
        Icon: ${toPascalCase(icon.name)},
    }`
    })

    data += res.join(',\n')
    data += `\n]

export default icons
`

    return data
}

const main = async () => {
    try {
        const data = generate(icons)
        fs.writeFileSync(outputDataFilePath, data)
        console.log('The file has been generated with success !')
    } catch (error) {
        console.error('Error while generating the file:', error)
    }
}

main()
