import metadata from '@solar-icons/core/metadata.json' assert { type: 'json' }
import fs from 'node:fs'

const toPascalCase = (str: string) =>
  str
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join('')

const outputFilePath = './core/generated/generatedHeroUtils.ts'
const generateIconsByCategory = (data: any) => {
  const categories = data.categories
  const categoryList: string[] = []
  const allIconsSet = new Set<string>()
  let categoryBodies = ''

  Object.entries(categories).forEach(([categoryName, categoryData]: [string, any]) => {
    const icons = categoryData.icons

    // Check that there are at least 17 icons for the category (7 + 10)
    if (icons.length < 17) return
    const categoryPascalCase = toPascalCase(categoryName)
    categoryList.push(categoryPascalCase)

    // Separates icons into internal (7) and external (10)
    const innerIconsNames = icons.slice(0, 7).map((icon: string) => toPascalCase(icon))
    const outerIconsNames = icons.slice(7, 17).map((icon: string) => toPascalCase(icon))

    innerIconsNames.forEach((name: string) => allIconsSet.add(name))
    outerIconsNames.forEach((name: string) => allIconsSet.add(name))

    categoryBodies += `
    case '${categoryPascalCase}':
      return {
        inner: [
          ${innerIconsNames.join(',\n          ')}
        ],
        outer: [
          ${outerIconsNames.join(',\n          ')}
        ],
      };`
  })

  const sortedImports = Array.from(allIconsSet).sort()

  let output = `/* Generated by generateHeroUtils.ts */
import { ${sortedImports.join(', ')} } from '@solar-icons/react'

export const styles = ['Broken', 'Outline', 'Linear', 'Bold', 'LineDuotone', 'BoldDuotone'] as const
export type Style = (typeof styles)[number]

export const getIconsByCategory = (category: string) => {
  switch (category) {${categoryBodies}
    default:
      return {
        inner: [],
        outer: [],
      };
  }
}

export const categories = ${JSON.stringify(categoryList)} as const
export type Category = typeof categories[number]
`

  return output
}

const main = async () => {
  try {
    const outputContent = generateIconsByCategory(metadata)
    fs.writeFileSync(outputFilePath, outputContent)
    console.log('The file core/generated/generatedHeroUtils.ts has been generated successfully !')
  } catch (error) {
    console.error('Error generating file :', error)
  }
}

main()
